# Ten Thousand Strategy

[Ten thousand](https://en.wikipedia.org/wiki/Dice_10000) (also known as Farkle or Greed) is a dice game with folk origins. The rules vary extensively, but I've modelled this program after the rules that my family likes to use. This program acts as score maximization engine for ten thousand. That is to say, it will guide you in making the best possible decisions assuming you want to have the highest score. This is in contrast to a win probability maximization engine, which as the name suggests would ensure that you have the greatest chance of beating your opponent. The difference, for example, is that a win probability maximization engine may be more cautious about letting someone steal your points as it would not only result in you coming closer to losing but would result in them coming closer to winning. Developing a win probability maximization engine for 4-player games and a convoluted ruleset is a challenge of its own, and I've taken the slightly easier route of simply having it maximize my score.

# Dice Roll Scanning

In order to maximize score for a given dice roll, it is necessary to develop a method of exhausting all possible dice combinations you could extract from that roll (1 or 5, three of a kind, run of 6, etc). Moreover, some of these may be mutually exclusive (a run of 5 may include a 5, but they cannot both be extracted at once since they overlap). To overcome this difficulty, I use an NFA to scan all possible positively scoring dice combinations from a sorted roll, and then use a simple algorithm to sort them into various 'interpretations'. Interpretations contain a maximum amount of positively scoring dice combinations while being distinct from other interpretations. For example, two interpretations of the roll '1, 2, 3, 4, 5, 6' would be a single run of 6, and a combined interpretation for 1 and 5.

# Maximization

The main feat of the engine is the calculation of the Ens and Est matrices (expected no-steal future score and expected steal future score, respectively). These correspond to two distinct gameplay styles. In one, the player continuously rolls for the highest score and may bank at any point. In the other, opponents may attempt to steal the player's roll if the player chooses to bank. The aim is then to calculate the expected value, and under that constraint, attempt to maximize it as much as possible. The expected value for a given number of dice remaining at a given score is calculated by averaging over the expectations for each possible dice combination the player could roll. Since the player must extract some positive score from their roll, the matrices can be calculated from the top-down as the calculation for a given score will only reference the expectations of higher scores. The maximization is performed by, for a given roll, taking the interpretation list given by the roll scan and determining the subset of any of the interpretations which produces the maximal future expected score when combined with the scores extracted from the dice.

## No-Steal Matrix

The no-steal matrix, Ens, and its corresponding expectation function E, are based on a simple premise. The idea is that you should stop rolling once your future expectation (supposing you continue rolling) dips below zero. At this point the expectation function for the current entry is set to zero, since the assumption is that the player will bank instead and will accordingly neither gain nor lose any future points.

## Steal Matrix

The steal matrix, Est, and its corresponding expectation function Es, are similar to the no-steal matrix but with an important modification. Instead of banking when the expected future score dips below zero, the player should wait until the expected future score dips below the negative of the current score multiplied by the success probability for the number of dice remaining, where the success probability is the chance that, when rolled, the dice will produce anything that can be extracted to add to one's score. When the expectation dips below this value, it is set to this value as the player should now choose to bank and since the other player will presumably try to steal, it is expected that the player will lose this value on average in their score. This is necessary since the player is no longer just competing against random chance, they are competing against another player who will steal all of their points if they leave them too many dice to steal with. Accordingly, it is easily possible to have a negative future point expectation but to be forced to continue rolling since otherwise your opponent will attempt to steal your score. This is evidenced by the many negative values in the matrix.

# Gameplay

To tie all this theory together, the 'play' function will simulate a gameplay session between 4 players while advising you on the optimal strategic moves for various sections of the game. My family plays the game such that maximum player scores from 0 to 2950 correspond to no stealing, from 3000 to 5950 to one steal per turn, and from 6000 onward to 10000 to unlimited stealing. This is the simulated gamemode, and all of the decisions involved are made by combining the no-steal and steal matrices.
